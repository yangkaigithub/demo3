## 1. 4.0设计
随着时代发展、技术发展和客户需求增多等，原来的3.0架构设计已经不能满足未来的需求，同时8200系列产品所包含的子系统越来越多，整体集成复杂度提升，需要确定一个完整的架构来承载其后续的成长。
8200系列产品4.0架构应运而生，是为解决现有架构的问题，适应公司技术体系，同时能满足未来一段时间的发展，主要是集群、高可靠、虚拟化、云化。

## 2. WEB服务的总体架构和安全架构

### 2.1 WEB服务的总体架构
![WEB服务架构图](img/webservice-structure.png)
WEB服务架构图，参考《iVMS-8200产品系列4.0总体架构设计说明书.docx》。

### 2.2 网络安全架构（多机部署）

![开发安全](img/dev-safety.png)
开发安全总体架构，参考《公安事业部技术体系-(2)开发篇-(3)安全开发规范.docx》

说明：
1. 红色边框表示程序运行范围；
2. WEB容器：只监听本地IP，即127.0.0.1；
3. 页面层：输入都必须经过前端校验；
4. 软waf：用于通用基础防御和项目安全补丁统一升级修复，目前demo中实现了xss防护；
5. Controller层：输入都必须经过后台校验；
6. DAO层：SQL注入的校验；
7. 启动Config层：加密配置信息，启动后加载到进程内解密使用。

## 3. 分布式服务架构
1. 服务的注册和发现以服务为单位，不以组件为单位；
2. 使用Spring Cloud Netflix + zookeeper作为服务注册和发现的技术载体；
3. 使用Spring Cloud Feign作为客户端，默认使用Ribbon进行负载均衡；
4. 使用Spring Cloud Hystrix作为客户端熔断机制；
5. 使用RESTEasy发布标准REST服务对外接口。

分布式基本服务结构如下图所示：
![分布式服务结构图.png](img/分布式服务结构图.png)
分布式服务结构图，参考《iVMS-8200产品系列4.0总体架构设计说明书.docx》

> 注：本demo只展示基础服务组件，即hik-ga-*